{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="header">
        <div class="emoji">ðŸ“‹</div>
        <h1>Health Profile</h1>
        <p>Tell us about yourself</p>
    </div>

    <div class="card">
        <div id="errorMsg" class="error" style="display:none;"></div>
        
        <form id="surveyForm" onsubmit="submitSurvey(event)">
            <div class="form-group">
                <label for="height">Height (inches)</label>
                <input type="number" id="height" min="36" max="96" required>
            </div>

            <div class="form-group">
                <label for="weight">Weight (lbs)</label>
                <input type="number" id="weight" min="50" max="500" required>
            </div>

            <div class="form-group">
                <label for="age">Age</label>
                <input type="number" id="age" min="5" max="120" required>
            </div>

            <div class="form-group">
                <label for="gender">Gender</label>
                <select id="gender" required>
                    <option value="">Select...</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label for="sex">Sex</label>
                <select id="sex" required>
                    <option value="">Select...</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label for="vitamins">Vitamins / Supplements</label>
                <textarea id="vitamins" placeholder="e.g., Vitamin D, Omega-3..."></textarea>
            </div>

            <div class="form-group">
                <label for="medications">Medications</label>
                <textarea id="medications" placeholder="List any medications..."></textarea>
            </div>

            <div class="form-group">
                <label for="injuries">Medical Injuries</label>
                <textarea id="injuries" placeholder="Any past or current injuries..."></textarea>
            </div>

            <div class="form-group">
                <label for="abnormalities">Medical Abnormalities</label>
                <textarea id="abnormalities" placeholder="Any medical conditions..."></textarea>
            </div>

            <div class="form-group">
                <label for="goals">Health & Fitness Goals</label>
                <textarea id="goals" placeholder="What do you want to achieve?" required></textarea>
            </div>

            <div class="form-group">
                <label for="other">Anything Else?</label>
                <textarea id="other" placeholder="Additional information..."></textarea>
            </div>

            <button type="submit" class="btn">Start Your Health Journey â†’</button>
            <div id="loader" class="loader" style="display:none;"></div>
        </form>
    </div>
</div>

<script>
async function submitSurvey(e) {
    e.preventDefault();
    
    const errorMsg = document.getElementById('errorMsg');
    const loader = document.getElementById('loader');
    const btn = e.target.querySelector('button[type="submit"]');
    
    errorMsg.style.display = 'none';
    btn.style.display = 'none';
    loader.style.display = 'block';
    
    const formData = {
        height: document.getElementById('height').value,
        weight: document.getElementById('weight').value,
        age: document.getElementById('age').value,
        gender: document.getElementById('gender').value,
        sex: document.getElementById('sex').value,
        vitamins: document.getElementById('vitamins').value,
        medications: document.getElementById('medications').value,
        injuries: document.getElementById('injuries').value,
        abnormalities: document.getElementById('abnormalities').value,
        goals: document.getElementById('goals').value,
        other: document.getElementById('other').value
    };
    
    try {
        const response = await fetch('/api/save-profile', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            window.location.href = '/chat';
        } else {
            errorMsg.textContent = data.error || 'Failed to save profile';
            errorMsg.style.display = 'block';
            btn.style.display = 'block';
            loader.style.display = 'none';
        }
    } catch (error) {
        errorMsg.textContent = 'Network error. Please try again.';
        errorMsg.style.display = 'block';
        btn.style.display = 'block';
        loader.style.display = 'none';
    }
}
</script>
{% endblock %}

